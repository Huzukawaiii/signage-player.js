<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your caroussel</title>

    <link href="https://kit-pro.fontawesome.com/releases/v5.15.1/css/pro.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js"
        integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj"
        crossorigin="anonymous"></script>

    <style>
        body {
            overflow: hidden;
            background-color: #333;
            cursor: none;
            /* Hide scrollbars */
        }

        #slideshow {
            display: grid;
            height: 100%;
        }

        * {
            margin: 0;
            padding: 0;
        }

        .l {
            max-width: 100%;
            max-height: 100vh;
            height: 100vh;
            width: 100%;
            margin: auto;
        }

        img {
            position: fixed;
            max-width: 100%;
            max-height: 100vh;
            width: 100%;
            height: 100vh;
            margin: auto;
            opacity: 1;
        }

        video {
            position: fixed;
            max-width: 100%;
            max-height: 100vh;
            width: 100%;
            height: 100vh;
            margin: auto;
            opacity: 1;
        }

        video::-webkit-media-controls-start-playback-button {
            display: none;
        }
    </style>
</head>

<body>
    <div id="slideshow">
    </div>
    <script>
        var content = "{{data1}}"
        var object = {}

        content.forEach(async (element, index) => {
            var extension = element.substring(element.lastIndexOf(".") + 1);

            var extension_image = ["png", "jpg", "jpeg", "gif"]
            var extension_video = ["mp4", "webm"]

            if (extension_image.includes(extension)) {
                object[index] = document.createElement("img");
                object[index].setAttribute("src", `contents/${element}`)
                object[index].hidden = true
                document.getElementById("slideshow").appendChild(object[index])
            } else if (extension_video.includes(extension)) {
                object[index] = document.createElement("VIDEO");
                object[index].setAttribute("src", `contents/${element}`)
                object[index].hidden = true
                document.getElementById("slideshow").appendChild(object[index])
            }
        })

        setTimeout(() => {
            function fadeIn(el, time) {
                el.style.opacity = 0;
                el.style.display = "block";

                var last = +new Date();
                var tick = function () {
                    el.style.opacity = +el.style.opacity + (new Date() - last) / time;
                    last = +new Date();

                    if (+el.style.opacity < 1) {
                        (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16)
                    }
                };

                tick();
            }

            function fadeOut(el, time) {
                el.style.opacity = 1;
                el.style.display = "block";

                var last = +new Date();
                var tick = function () {
                    el.style.opacity = el.style.opacity - (new Date() - last) / time;
                    last = +new Date();

                    if (el.style.opacity > 0) {
                        (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16)
                    }
                };

                tick();
            }

            (refresh = () => {
                var data = {
                    interval: 0,
                    delay: 5000,
                    fadeSpeed: 1000
                }

                console.log("restarted")

                for (const key in object) {
                    if (Object.hasOwnProperty.call(object, key)) {
                        const element = object[key];
                        const index = key

                        const actualInterval = data.interval

                        var delay = data.delay

                        if (element.tagName == "VIDEO") {
                            data.interval += (element.duration * 1000) + (data.fadeSpeed / 2)
                        } else if (element.tagName == "IMG") {
                            data.interval += data.delay
                        }

                        console.log(actualInterval)

                        setTimeout(function () {
                            console.log("GO")

                            if (element.tagName == "IMG") {
                                element.hidden = false
                                fadeIn(element, data.fadeSpeed)

                                setTimeout(() => {
                                    fadeOut(element, data.fadeSpeed)
                                    element.hidden = true
                                    setTimeout(() => {
                                        if (index.toString() === (content.length - 1).toString()) {
                                            refresh()
                                        }
                                    }, data.fadeSpeed);
                                }, delay - data.fadeSpeed);
                            } else if (element.tagName == "VIDEO") {
                                element.hidden = false
                                element.play()
                                fadeIn(element, data.fadeSpeed)

                                setTimeout(() => {
                                    fadeOut(element, data.fadeSpeed)
                                    element.hidden = true
                                    setTimeout(() => {
                                        if (index.toString() === (content.length - 1).toString()) {
                                            refresh()
                                        }
                                    }, data.fadeSpeed);
                                }, (element.duration * 1000) - data.fadeSpeed + 500);
                            }
                        }, actualInterval);
                    }
                }
            })();
        }, 1000);
    </script>
</body>

</html>