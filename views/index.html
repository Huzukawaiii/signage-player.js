<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <style>
        body {
            overflow: hidden;
            background-color: #333;
            /* Hide scrollbars */
        }

        #slideshow {
            display: grid;
            height: 100%;
        }

        * {
            margin: 0;
            padding: 0;
        }

        .l {
            max-width: 100%;
            max-height: 100vh;
            height: 100vh;
            width: 100%;
            margin: auto;
        }

        img {
            max-width: 100%;
            max-height: 100vh;
            width: 100%;
            height: 100vh;
            margin: auto;
        }

        audio::-webkit-media-controls-timeline,
        video::-webkit-media-controls-timeline {
            display: none;
        }

        audio::-webkit-media-controls,
        video::-webkit-media-controls {
            display: none;
        }
    </style>
</head>

<body>
    <div id="slideshow"></div>

    <script>
        // $("#slideshow > div:gt(0)").hide();

        // var dataIn.delay = 5

        // setInterval(function () {
        //     $('#slideshow > div:first')
        //         .fadeOut(1000)
        //         .next()
        //         .fadeIn(1000)
        //         .end()
        //         .appendTo('#slideshow');
        // }, dataIn.delay * 1000);

        function wait(secondes) {
            var start = new Date().getTime();
            for (var i = 0; i < 1e7; i++) {
                if ((new Date().getTime() - start) > secondes * 1000) {
                    break;
                }
            }
        }


        (refresh = () => {
            var content = ["flower.webm", "PNG_transparency_demonstration_1.png", "depositphotos_2983099-stock-illustration-grunge-design.jpg", "gif-anime.gif"]
            var data = {
                interval: 0,
                fadeSpeed: 1000
            }

            function fadeIn(el, time) {
                el.style.opacity = 0;
                el.style.display = "block";

                var last = +new Date();
                var tick = function () {
                    el.style.opacity = +el.style.opacity + (new Date() - last) / time;
                    last = +new Date();

                    if (+el.style.opacity < 1) {
                        (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16)
                    }
                };

                tick();
            }

            function fadeOut(el, time) {
                el.style.opacity = 1;
                el.style.display = "block";

                var last = +new Date();
                var tick = function () {
                    el.style.opacity = el.style.opacity - (new Date() - last) / time;
                    last = +new Date();

                    if (el.style.opacity > 0) {
                        (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16)
                    }
                };

                tick();
            }


            content.forEach(async (element, index) => {
                var extension = element.substring(element.lastIndexOf(".") + 1);

                var extension_image = ["png", "jpg", "jpeg", "gif"]
                var extension_video = ["mp4", "webm"]

                var dataIn = {
                    delay: 8000
                }




                if (extension_video.includes(extension)) {
                    let delay;
                    var vid = document.createElement('video');
                    vid.src = "contents/" + element;
                    vid.ondurationchange = async function () {
                        delay = this.duration
                        dataIn.delay = this.duration
                    };
                    vid.remove()
                    do {
                        wait(1)
                    } while (delay === undefined);
                };





                if (index != 0) {
                    data.interval = data.interval + dataIn.delay
                }


                setTimeout(function () {
                    if (extension_image.includes(extension)) {
                        $("#slideshow")[0].innerHTML = `<img src="contents/${element}">`
                        fadeIn($("#slideshow").find("img")[0], data.fadeSpeed)

                        setTimeout(() => {
                            fadeOut($("#slideshow").find("img")[0], data.fadeSpeed)
                        }, dataIn.delay - data.fadeSpeed);
                    } else if (extension_video.includes(extension)) {
                        $("#slideshow")[0].innerHTML = `<video controls autoplay class="l"><source src="contents/${element}"></video>`
                        fadeIn($("#slideshow").find("video")[0], data.fadeSpeed)

                        console.log(dataIn.delay)

                        setTimeout(() => {
                            fadeOut($("#slideshow").find("video")[0], data.fadeSpeed)
                        }, dataIn.delay - data.fadeSpeed);
                    }

                    if (index == content.length - 1) {
                        setTimeout(() => {
                            refresh()
                        }, data.interval - dataIn.delay)
                    }

                }, data.interval);
            })
        })();

    </script>
</body>

</html>